<html>
{{template "header.tmpl.html"}}
<body>
{{template "nav.tmpl.html"}}


<link href="/static/vendor/bootstrap/css/bootstrap.min.css" rel="stylesheet" id="bootstrap-css">
<script src="/static/vendor/bootstrap/js/bootstrap.min.js"></script>
<script src="/static/vendor/jquery/jquery.min.js"></script>
<!------ Include the above in your HEAD tag ---------->

<link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.0.8/css/all.css">

<div class="wrapper">
    <div class="container content">
        <hr>
        <div class="card bg-light">
            <article class="card-body mx-auto" style="max-width: 400px;">
                <h4 class="card-title mt-3 text-center">Create Account</h4>
                <p class="text-center">Get started with your free account</p>
                <p class="divider-text">
                    <span class="bg-light">Enter youre credentials</span>
                </p>
                <form>
                    <div class="form-group input-group">
                        <div class="input-group-prepend">
                            <span class="input-group-text"> <i class="fa fa-user"></i> </span>
                        </div>
                        <input name="" class="form-control" placeholder="Nickname" type="text" id="inputNickname">
                    </div> <!-- form-group// -->
                    <div class="form-group input-group">
                        <div class="input-group-prepend">
                            <span class="input-group-text"> <i class="fa fa-envelope"></i> </span>
                        </div>
                        <input name="" class="form-control" placeholder="Email address" type="email" id="inputEmail">
                    </div> <!-- form-group// -->

                    <div class="form-group input-group">
                        <div class="input-group-prepend">
                            <span class="input-group-text"> <i class="fa fa-lock"></i> </span>
                        </div>
                        <input class="form-control" placeholder="Create password" type="password" id="passwordInput">
                    </div> <!-- form-group// -->
                    <div class="form-group input-group">
                        <div class="input-group-prepend">
                            <span class="input-group-text"> <i class="fa fa-lock"></i> </span>
                        </div>
                        <input class="form-control" placeholder="Repeat password" type="password" id="passwordInput2">
                    </div> <!-- form-group// -->
                    <div class="form-group">
                        <button type="submit" id="createButton" class="btn btn-primary btn-block"> Create Account
                        </button>
                    </div> <!-- form-group// -->
                    <p class="text-center">Have an account? <a href="/login">Log In</a></p>
                </form>
            </article>
        </div> <!-- card.// -->

        <script>
            $('#createButton').on('click', function (e) {
                var email = document.getElementById("inputEmail").value;
                var password = document.getElementById("passwordInput").value;
                var password2 = document.getElementById("passwordInput2").value;
                var nickname = document.getElementById("inputNickname").value;
                if (password != password2) {
                    alert("Passwords are not equal!");
                    return;
                }

                function validateEmail(email) {
                    var re = /^(([^<>()[\]\\.,;:\s@\"]+(\.[^<>()[\]\\.,;:\s@\"]+)*)|(\".+\"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/;
                    return re.test(email);
                }

                if (!validateEmail(email)) {
                    $result.text(email + " is valid :)");
                    $result.css("color", "green");
                    return;
                }


                var xhr = new XMLHttpRequest();

                var data = JSON.stringify({
                    "email": email,
                    "nickname": nickname,
                    "password": password
                });

                xhr.open('POST', "/api/v1/register", false);
                xhr.setRequestHeader('Content-Type', 'application/json');
                xhr.onreadystatechange = function () {
                    if (xhr.readyState == XMLHttpRequest.DONE && this.status == 200) {
                        window.location.href = "/";
                    } else {
                        alert("Nickname or email is already registered!");
                        window.location.href = "/register";
                    }
                };
                xhr.send(data);
            });
        </script>

    </div>

    <!--container end.//-->
{{template "footer.tmpl.html"}}

</body>
</html>
