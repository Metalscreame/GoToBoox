<html>
{{template "header.tmpl.html"}}
<body>
{{template "navLogout.tmpl.html"}}

<link href="/static/vendor/bootstrap/css/bootstrap.min.css" rel="stylesheet" id="bootstrap-css">
<script src="/static/js/jquery-1.11.1.js"></script>

<!------ Include the above in your HEAD tag ---------->
      <div class="wrapper">
<div class="container content">
<div class="row">
    <div class="col-md-6 col-md-offset-6">
        <form class="form-horizontal" role="form">
            <fieldset>

                <!-- Form Name -->
                <h4 class="card-title mt-3 text-left">Account Details</h4>

                <!-- Text input-->
                <div class="form-group">
                    <label class="col-sm-2 control-label" for="textinput">Nickname</label>
                    <div class="col-sm-10">
                        <input type="text" placeholder="Youre nickname" class="form-control" id="nicknameInput">
                    </div>
                </div>

                <!-- Text input-->
                <div class="form-group">
                    <label class="col-sm-2 control-label" for="textinput">Email</label>
                    <div class="col-sm-10">
                        <input type="text" placeholder="Your Email" class="form-control" id="emailInput">
                    </div>
                </div>

                <!-- Text input-->
                <div class="form-group">
                    <label class="col-sm-2 control-label" for="textinput">Password</label>
                    <div class="col-sm-10">
                        <input type="password" placeholder="Old password" class="form-control" id="passwordInputOld">
                    </div>
                    <label class="col-sm-2 control-label" for="textinput"></label>

                    <div class="col-sm-10">
                        <input type="password" placeholder="New password" class="form-control" id="passwordInputNew1">
                    </div>
                    <div class="col-sm-10">
                        <label class="col-sm-2 control-label" for="textinput"></label>

                        <input type="password" placeholder="Repeat" class="form-control" id="passwordInputNew2">
                    </div>

                </div>

                <div class="form-group">
                    <div class="col-sm-offset-2 col-sm-10">
                        <div class="pull-right">
                            <button type="submit" id="saveButton" class="btn btn-primary">Save changes</button>
                            <button type="submit" id="deleteButton" class="btn btn-default">Delete user</button>
                            <button type="submit" id="goBackButton" class="btn btn-default">Go back</button>
                        </div>
                    </div>
                </div>

            </fieldset>
        </form>
    </div><!-- /.col-lg-12 -->
</div><!-- /.row -->
          </div>

<script>

    $('#saveButton').on('click', function (e) {
        var nickname = document.getElementById("nicknameInput").value;
        var email = document.getElementById("emailInput").value;
        var passwordOld = document.getElementById("passwordInputOld").value;
        var passwordNew1 = document.getElementById("passwordInputNew1").value;
        var passwordNew2 = document.getElementById("passwordInputNew2").value;

        if(passwordNew1!=passwordNew2){
            alert("Passwords doesnt mach");
            return
        }

        var xhr = new XMLHttpRequest();
        xhr.open('PUT', "/api/v1/userProfile", false);
        xhr.setRequestHeader("Content-Type", "application/json");
        xhr.onreadystatechange = function () {
            if (xhr.readyState == 4 && xhr.status == 200) {
                alert("redirecting");
                document.location.href="/";
                return;
            } else {
                alert("wrong old password");
                window.location.href = "/userProfile";
                return;
            }
        };
        var body = JSON.stringify({
            "nickname": nickname,
            "email": email,
            "password": passwordOld,
            "new_passwordd": passwordNew1
        });
        xhr.send(body);
    });

    <!-- deleteButton -->
    $('#deleteButton').on('click', function (e) {
        var xhr = new XMLHttpRequest();
        xhr.open('DELETE', "/api/v1/userProfile", false);
        xhr.setRequestHeader("Content-Type", "application/json");
        xhr.send();
        window.location.href = "/login";
    });

    // $('#goBackButton').on('click', function (e) {
    //     window.location.href =window.location.protocol + "//" + window.location.host + "/" ;
    // });
</script>

<script>
    var xhr = new XMLHttpRequest();
    xhr.open('GET', "/api/v1/userProfile", false);
    xhr.setRequestHeader("Content-Type", "application/json");
    xhr.onreadystatechange = function () {
        if (xhr.readyState == XMLHttpRequest.DONE && xhr.status == 200) {
            var json = JSON.parse(xhr.responseText);
            $('#nicknameInput').val(json.nickname);
            $('#emailInput').val(json.email);
        } else if (xhr.readyState == XMLHttpRequest.DONE && xhr.status == 400) {
            window.location.href = "/login";
        }
        else {
        }
    };
    xhr.send();
</script>

{{template "footer.tmpl.html"}}

</body>
</html>
