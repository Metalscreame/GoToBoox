<html>
{{template "header.tmpl.html"}}
<body>
{{template "navLogout.tmpl.html"}}

<link href="/static/vendor/bootstrap/css/bootstrap.min.css" rel="stylesheet" id="bootstrap-css">
<script src="/static/js/jquery-1.11.1.js"></script>

<!------ Include the above in your HEAD tag ---------->
      <div class="wrapper">
<div class="container content">
<div class="row">

    <div class="col-md-6 col-md-offset-6">
        <form class="form-horizontal" role="form">
            <fieldset>
                <h2 class="card-title mt-5 text-left ms">Account Details</h2>
                <div class="form-group">
                    <label class="col-sm-2 control-label" for="textinput">Nickname</label>
                    <div class="col-sm-10">
                        <input type="text" placeholder="Youre nickname" class="form-control" id="nicknameInput">
                    </div>
                </div>
                <div class="form-group">
                    <label class="col-sm-2 control-label" for="textinput">Email</label>
                    <div class="col-sm-10">
                        <input type="text" placeholder="Your Email" class="form-control" id="emailInput">
                    </div>
                </div>
                <div class="form-group">
                    <label class="col-sm-2 control-label" for="textinput">Password</label>
                    <div class="col-sm-10">
                        <input type="password" placeholder="Old password" class="form-control" id="passwordInputOld">
                    </div>
                    <label class="col-sm-2 control-label" for="textinput"></label>

                    <div class="col-sm-10">
                        <input type="password" placeholder="New password" class="form-control" id="passwordInputNew1">
                    </div>
                    <div class="col-sm-10">
                        <label class="col-sm-2 control-label" for="textinput"></label>

                        <input type="password" placeholder="Repeat" class="form-control" id="passwordInputNew2">
                    </div>

                    <h4 class="card-title mt-3 text-left">Email notifications</h4>
                    <div class="col-sm-11">
                        <div class="form-check">
                            <input type="checkbox" class="form-check-input" id="notificationNewBooks">
                            <label class="form-check-label" for="exampleCheck1">Receive notification when the new book is added</label>
                        </div>
                        <label for="space"></label>
                        <div class="form-check">
                            <input type="checkbox" class="form-check-input" id="notificationReservedBook">
                            <label class="form-check-label" for="exampleCheck1">Receive notification when the book is reserved</label>
                        </div>
                    </div>

                </div>

                <div class="form-group">
                    <div class="col-sm-offset-2 col-sm-10">
                        <div class="pull-right">
                            <button type="submit" id="deleteButton" class="btn btn-dark">Delete current user</button>
                            <button type="submit" id="saveButton" class="btn btn-dark">Save changes</button>
                        </div>
                    </div>
                </div>
            </fieldset>
        </form>


    </div><!-- /.col-lg-12 -->

    <div class="col-md-6 col-md-offset-6">
        <form class="form-horizontal" role="form">
            <fieldset>
                <h2 class="card-title mt-5 text-left">Operations with books</h2>
                <h2 class="card-title mt-5 text-left"></h2>

                <h4 class="card-title mt-3 text-left">Donate people a book</h4>
                <button type="submit" id="donateButton" class="btn btn-dark">Donate</button>

                <h2 class="card-title mt-5 text-left"></h2>
                <h2 class="card-title mt-5 text-left"></h2>

                <h4 class="card-title mt-3 text-left">Return previously taken book</h4>
                <button type="submit" id="returnButton" class="btn btn-dark">Return</button>

                <h2 class="card-title mt-5 text-left"></h2>
                <h2 class="card-title mt-5 text-left"></h2>
                <h2 class="card-title mt-5 text-left"></h2>
                <h2 class="card-title mt-5 text-left"></h2>

                <script>
                    $('#exchangeBookButton').on('click', function (e) {
                        var xhr = new XMLHttpRequest();
                        var email = document.getElementById("emailInput").value;
                        xhr.open('GET', '/api/v1/makeBookCross',false);
                        xhr.setRequestHeader("Content-Type", "application/json");
                        xhr.send();
                        window.location.href = "/";
                    });
                </script>
                <div id="returnBookRender">

                </div>

            </fieldset>

        </form>

    </div>
</div><!-- /.row -->
          </div>

<script>

    $('#saveButton').on('click', function (e) {
        var nickname = document.getElementById("nicknameInput").value;
        var email = document.getElementById("emailInput").value;
        var passwordOld = document.getElementById("passwordInputOld").value;
        var passwordNew1 = document.getElementById("passwordInputNew1").value;
        var passwordNew2 = document.getElementById("passwordInputNew2").value;

        if(passwordNew1!=passwordNew2){
            alert("Passwords doesnt mach");
            return
        }

        var xhr = new XMLHttpRequest();
        xhr.open('PUT', "/api/v1/userProfile", false);
        xhr.setRequestHeader("Content-Type", "application/json");
        xhr.onreadystatechange = function () {
            if (xhr.readyState == 4 && xhr.status == 200) {
                document.location.href="/";
                return;
            } else {
                alert("wrong old password");
                window.location.href = "/userProfile";
                return;
            }
        };

        var notification_get_new_books=false;
        if ($('#notificationNewBooks').is(":checked")) {
            notification_get_new_books = true;
        }
        var notification_get_when_book_reserved=false;
        if ($('#notificationReservedBook').is(":checked")) {
            notification_get_when_book_reserved = true;
        }
        var body = JSON.stringify({
            "nickname": nickname,
            "email": email,
            "password": passwordOld,
            "new_passwordd": passwordNew1,
            "notification_get_new_books":notification_get_new_books,
            "notification_get_when_book_reserved":notification_get_when_book_reserved
        });
        xhr.send(body);
    });

    <!-- deleteButton -->
    $('#deleteButton').on('click', function (e) {
        var xhr = new XMLHttpRequest();
        xhr.open('DELETE', "/api/v1/userProfile", false);
        xhr.setRequestHeader("Content-Type", "application/json");
        xhr.send();
        window.location.href = "/login";
    });

    // $('#goBackButton').on('click', function (e) {
    //     window.location.href =window.location.protocol + "//" + window.location.host + "/" ;
    // });


    $('#donateButton').on('click',function (e) {
        var xhr = new XMLHttpRequest();
        xhr.open('GET', "/uploadPage/0", false);
        xhr.send();
    });


</script>

<script>
    var xhr = new XMLHttpRequest();
    xhr.open('GET', "/api/v1/userProfile", false);
    xhr.setRequestHeader("Content-Type", "application/json");
    xhr.onreadystatechange = function () {
        if (xhr.readyState == XMLHttpRequest.DONE && xhr.status == 200) {
            var json = JSON.parse(xhr.responseText);
            $('#nicknameInput').val(json.nickname);
            $('#emailInput').val(json.email);
            if(json.notification_get_new_books == true){
                $('#notificationNewBooks').prop( "checked", true );
            }
            if(json.notification_get_when_book_reserved == true){
                $('#notificationReservedBook').prop( "checked", true );
            }

            if(json.has_book_for_exchange == true){
                document.getElementById("returnBookRender").innerHTML = '<h4 class="card-title mt-3 text-left">Exchange previously reserved book</h4> ' +
                        '<button type="submit" id="exchangeBookButton" class="btn btn-dark">Return</button>';
            }
        } else if (xhr.readyState == XMLHttpRequest.DONE && xhr.status == 400) {
            window.location.href = "/login";
        }
        else {
        }
    };
    xhr.send();
</script>

{{template "footer.tmpl.html"}}

</body>
</html>
